---
title: "Mappe_1"
format: pdf
editor: visual
echo: false
warning: false
---

```{r, warning=FALSE}

rm(list=ls()) 
library(tidyverse)
library(rjstat)
library(httr)
library(cowplot)
library(lubridate)
library(dplyr)
library(ggthemes)
#options(scipen = 999)
```

```{r}
url <- 'https://data.ssb.no/api/v0/no/table/09171/'
  
query <- '{
  "query": [
    {
      "code": "NACE",
      "selection": {
        "filter": "item",
        "values": [
          "nr23_6",
          "pub2X01_02",
          "pub2X03",
          "pub2X05",
          "nr2X06_09",
          "pub2X06",
          "pub2X09",
          "nr23ind",
          "pub2X10_12",
          "nr2310",
          "nr2312",
          "pub2X13_15",
          "nr2315",
          "nr2316",
          "pub2X18",
          "pub2X19_21",
          "nr2319",
          "pub2X22_23",
          "pub2X24",
          "pub2X25_28",
          "pub2X29_30",
          "pub2X31_32",
          "pub2X33",
          "pub2X35",
          "pub2X36_39",
          "pub2X41_43",
          "pub2X45_47",
          "pub2X49B",
          "pub2X50A",
          "pub2X49A_52",
          "pub2X53",
          "pub2X55_56",
          "pub2X58_63",
          "pub2X64_66",
          "pub2X68A",
          "pub2X68B",
          "pub2X69_75",
          "pub2X77_82",
          "pub2X84",
          "pub2X85",
          "pub2X86_88",
          "pub2X90_97",
          "nr24_5",
          "nr24_",
          "nr24sivil",
          "nr2482",
          "nr25_",
          "nr23_6fn",
          "nr23fn",
          "nr23mark",
          "nrimark"
        ]
      }
    },
    {
      "code": "ContentsCode",
      "selection": {
        "filter": "item",
        "values": [
          "Prob",
          "BNPB",
          "Prob2",
          "BNPB2"
        ]
      }
    }
  ],
  "response": {
    "format": "json-stat2"
  }
}'

hent_indeks.tmp1 <- url %>%
  POST(body = query, encode = "json")

df <-  hent_indeks.tmp1 %>%
  content("text") %>%
  fromJSONstat() %>%
  as_tibble()
```

```{r}
# sysselsetting i antall årsverk*(1000)
url <- 'https://data.ssb.no/api/v0/no/table/09174/'
query <- '{
  "query": [
    {
      "code": "NACE",
      "selection": {
        "filter": "vs:NRNaeringPubAgg",
        "values": [
          "nr23_6",
          "pub2X01_02",
          "pub2X03",
          "pub2X05",
          "nr2X06_09",
          "pub2X06",
          "pub2X09",
          "nr23ind",
          "pub2X10_12",
          "nr2310",
          "nr2312",
          "pub2X13_15",
          "nr2315",
          "nr2316",
          "pub2X18",
          "pub2X19_21",
          "nr2319",
          "pub2X22_23",
          "pub2X24",
          "pub2X25_28",
          "pub2X29_30",
          "pub2X31_32",
          "pub2X33",
          "pub2X35",
          "pub2X36_39",
          "pub2X41_43",
          "pub2X45_47",
          "pub2X49B",
          "pub2X50A",
          "pub2X49A_52",
          "pub2X53",
          "pub2X55_56",
          "pub2X58_63",
          "pub2X64_66",
          "pub2X68A",
          "pub2X68B",
          "pub2X69_75",
          "pub2X77_82",
          "pub2X84",
          "pub2X85",
          "pub2X86_88",
          "pub2X90_97",
          "nr24_5",
          "nr24_",
          "nr24sivil",
          "nr2482",
          "nr25_",
          "nr23_6fn",
          "nr23fn",
          "nr23mark",
          "nrimark"
        ]
      }
    },
    {
      "code": "ContentsCode",
      "selection": {
        "filter": "item",
        "values": [
          "SysselsattNorm"
        ]
      }
    }
  ],
  "response": {
    "format": "json-stat2"
  }
}'

hent_indeks.tmp <- url %>%
  POST(body = query, encode = "json")

df_syssel <-  hent_indeks.tmp %>%
  content("text") %>%
  fromJSONstat() %>%
  as_tibble()
```

Oppgave 1 - 40% Lag to til fire figurer som sammenligninger sysselsetting, produksjon, bruttoprodukt, og bruttoprodukt per sysselsatt på tvers av næringer i 2021. Sysselsetting oppgis i antall årsverk, produksjon, bruttoprodukt, og bruttoprodukt per sysselsatt i løpende priser. Dere må selv avgjøre hvilke tall som er meningsfylte å sammenligne og hvorvidt dere ønsker å dele opp tallene i ulike figurer.

```{r}
df2 <- df %>%
separate(kvartal, 
         into=c("year"), 
         sep="K") %>% 
  mutate(year = (year)) %>% 
  rename(var = statistikkvariabel)

df2 <- df2 %>% 
  group_by(year, næring, var) %>% 
  summarise(verdi = sum(value))

df3<-df2 %>%
  pivot_wider(names_from = 'var', values_from='verdi') %>%
  rename(løpende = 'Produksjon i basisverdi. Løpende priser (mill. kr)',
         bruttoprodukt= 'Bruttoprodukt i basisverdi. Løpende priser (mill. kr)')


# sette sammen alle tre figurene til en 
df4 <-df3 %>%
  # filter for årstall som skal brukes
  filter(year == 2021) %>%
  # filter for næringene som skal sees videre på
  filter(næring %in% c("Helse- og omsorgstjenester", 
                       "Utvinning av råolje og naturgass, inkl. tjenester", 
                       "Jordbruk og skogbruk", "Undervisning", 
                       "Bygge- og anleggsvirksomhet",
                       "Fiske, fangst og akvakultur",
                       "Kultur, underholdning og annen tjenesteyting",
                       "Industri")) %>%
  # Regner ut prosentandelen i de ulike næringene
    mutate(brutto_pros=bruttoprodukt/5145241*100,
         produ_pros=løpende/8759224*100)


df_syssel <-df_syssel %>%
  filter(år == 2021) %>%
    filter(næring %in% c("Helse- og omsorgstjenester", 
                       "Utvinning av råolje og naturgass, inkl. tjenester", 
                       "Jordbruk og skogbruk", "Undervisning", 
                       "Bygge- og anleggsvirksomhet",
                       "Fiske, fangst og akvakultur",
                       "Kultur, underholdning og annen tjenesteyting",
                       "Industri")) %>%
  #regner ut en ny variabel som gir prosenten til sysselsatte i de ulike næringene
    mutate(pros_syssel=value/2518.7*100)

# Setter slik at næring går i samme 'order' nedover i radene på begge datasett
df4 <- df4[order(df4$næring), ]
df_syssel <- df_syssel[order(df_syssel$næring), ]
# lager en kolonne for variabel å jobbe videre med
pros_syssel <- df_syssel$pros_syssel
# setter kolonnen inn i df4
df4 <- cbind(syssel=pros_syssel, df4)

# setter verdiene som skal plottes sammen i en variabel
 df4 <-df4 %>%
pivot_longer(c('syssel','brutto_pros','produ_pros'), names_to = "names", values_to = "plot")
```

```{r}
df_syssel %>%
  ggplot(aes(x=næring, y=pros_syssel, fill=næring))+
  geom_col()+
  theme_minimal(base_size = 10)+
  scale_x_discrete(guide = guide_axis(n.dodge = 2),
                   labels=c("Kultur, underholdning og annen tjenesteyting"
                            ="Kultur og underholdning", "Utvinning av råolje og naturgass, inkl. tjenester"="Råolje og naturgass"))+
  theme(legend.position = "none",
        plot.title=element_text(size=12))+
  labs(y="Prosentandel", x="",
       title="Sysselsetting for næringer (prosent) 2021")+
 scale_y_continuous(breaks = seq(from = 0, to = 30, by = 5), limits=c(0,30))



```

```{r}
df3 %>%
  filter(year == 2021) %>%
  filter(næring %in% c("Helse- og omsorgstjenester", 
                       "Utvinning av råolje og naturgass, inkl. tjenester", 
                       "Jordbruk og skogbruk", "Undervisning", 
                       "Bygge- og anleggsvirksomhet",
                       "Fiske, fangst og akvakultur",
                       "Kultur, underholdning og annen tjenesteyting",
                       "Industri")) %>%
  # deler på totalt for alle næringerog ganger med 100 for å få prosentvis
  ggplot(aes(x=næring, y=bruttoprodukt/5145241*100, fill=næring))+
  theme_minimal(base_size=10)+
  geom_col()+
  theme(legend.position = "none",
        plot.title=element_text(size=12))+
  scale_x_discrete(guide = guide_axis(n.dodge = 2),
                   labels=c("Kultur, underholdning og annen tjenesteyting"
                            ="Kultur og underholdning", "Utvinning av råolje og naturgass, inkl. tjenester"="Råolje og naturgass"))+
    labs(y="Prosentandel", x="",
       title="Bruttoprodukt 2021")+
  scale_y_continuous(breaks = seq(from = 0, to = 30, by = 5), limits=c(0,30))
  

```

```{r}
df3 %>%
  filter(year == 2021) %>%
  filter(næring %in% c("Helse- og omsorgstjenester", 
                       "Utvinning av råolje og naturgass, inkl. tjenester", 
                       "Jordbruk og skogbruk", "Undervisning", 
                       "Bygge- og anleggsvirksomhet",
                       "Fiske, fangst og akvakultur",
                       "Kultur, underholdning og annen tjenesteyting",
                       "Industri")) %>%
  # deler på totalt for alle næringerog ganger med 100 for å få prosentvis
  ggplot(aes(x=næring, y=løpende/8759224*100, fill=næring))+
  theme_minimal(base_size=10)+
  geom_col()+
  theme(legend.position = "none",
        plot.title=element_text(size=12))+
  scale_x_discrete(guide = guide_axis(n.dodge = 2),
                   labels=c("Kultur, underholdning og annen tjenesteyting"
                            ="Kultur og underholdning", "Utvinning av råolje og naturgass, inkl. tjenester"="Råolje og naturgass"))+
    labs(y="Prosentandel", x="",
       title="Produksjon 2021")+
  scale_y_continuous(breaks = seq(from = 0, to = 30, by = 5), limits=c(0,30))
```

**Figur 1.1** Total produksjon i basisverdi (løpende priser) og bruttoprodukt i basisverdi (løpende priser) for alle næringer 2021

```{r}
df2 %>%
  filter(year == 2021) %>%
  filter(næring == "Totalt for næringer") %>%
  filter(var %in% c('Bruttoprodukt i basisverdi. Løpende priser (mill. kr)',
                    'Produksjon i basisverdi. Løpende priser (mill. kr)')) %>%
  ggplot()+
  # priser er i millioner kroner så deler på 1000 for å få de i millarder
    geom_col(aes(x=næring, y=verdi/1000, fill=var), position="dodge")+
   theme_minimal()+
  theme(legend.position="none", # fjerner legend
         axis.text.x=element_blank())+ #fjerner tekst fra x-akse
  annotate("text", x=0.77, y=2000, label=  # gir navn til søyle
             "Bruttoprodukt", size=5)+
  annotate("text", x=1.24, y=2000, label= # gir navn til søyle
             "Produksjon", size=5)+
  labs(title="Milliarder kroner 2021",x="",y="")+ # tittel
  # fikser så man ser bedre verdiene
  scale_y_continuous(breaks = seq(from = 0, to = 7000, by = 1000))
```

Produksjonen (det norske næringer produserte) for 2021 totalt var på 6848 milliarder kroner mens bruttoproduktet, som vil si verdiskapingen (produksjon-produktinnsats) var på 3782 milliarder kroner. Totalt for alle næringer var sysselsettingen på litt over 2.5 millioner årsverk (to femtiprosent stillinger regnes om til ett årsverk).

**Figur 1.2** Sysselsetting, produksjon og bruttoprodukt fordelt på næring, 2021

```{r}
df4 %>%
  ggplot()+ # starter plottet, dodge gjør slik at kolonnene går på siden
  geom_col(aes(x=næring, y=plot, fill=names),position = "dodge")+
  theme_minimal(base_size=10)+ # Endrer på tekst størrelsen til aksene
  theme(legend.position=c(0.75,0.92), # Setter legenden inn i figuren
    plot.title=element_text(size=12), # endrer størrelsen på teksen
    legend.direction="horizontal", # setter legenden fra vertikal til horisontal
    legend.text= element_text(size=8), # gjør legendestørrelse litt mindre
    legend.key.size = unit(0.4, "cm"))+ # fargeboks litt mindre
  scale_x_discrete(guide = guide_axis(n.dodge = 2), # fikser x-aksen
                   labels=c("Kultur, underholdning og annen tjenesteyting"
                            ="Kultur og underholdning", "Utvinning av råolje og naturgass, inkl. tjenester"="Råolje og naturgass"),
                   )+ # gir nye navn så de passer bedre i figuren
    labs(y="", x="", # fjerner variabel navnene som står som default
       title="Andeler (prosent) 2021")+ # setter tittel
  # lager en sequence for y-aksen fra 0-30 med step 5
  scale_y_continuous(breaks = seq(from = 0, to = 30, by = 5), limits=c(0,30))+
  # lager ordentlige navn på søylene
    scale_fill_discrete(name = "", labels = c("Bruttoprodukt",
                                            "Produksjon",
                                            "Sysselsetting"))
```

Produksjonen i industrien er faktisk høyere enn oljen, med sine 1095 millarder kroner mot olje- og gassutvinning som har 1066 millarder kroner i 2021 men på grunn av at industrien bruker produktinnsats fra andre næringer blir bruttoproduktet 236 milliarder som vil si ca. 23 prosent av produksjonen.

Ser man på råolje og naturgass så står dette alene for 18% av vårt bruttoprodukt for alle næringer. På grunn av at oljen er en verdifull naturressurs gjør dette slik at bruttoproduktet som er på 918 millarder kroner blir ca. hele 85 prosent av produksjonen.

**Oppgave 2 - 10%** Diskuter hvorvidt bruttoprodukt per sysselsatt er et godt mål på produktivitet i offentlig sektor.

Bruttoprodukt per sysselsatt er et mål på produktivitet som brukes til å sammenligne produktiviteten mellom ulike sektorer, inkludert offentlig sektor. Imidlertid er det noen begrensninger når det gjelder å bruke bruttoprodukt som et mål på produktivitet i offentlig sektor. For det første har offentlig sektor en annen form for organisering og produksjon enn privat sektor, noe som kan gjøre det vanskelig å sammenligne produktiviteten mellom sektorene. For det andre inkluderes bruttoprodukt vanligvis ikke i offentlig sektors kapitalavkastning, noe som kan undervurdere produktiviteten i offentlig sektor, spesielt hvis sektoren bruker mye kapital i produksjonen.

Selv om Brutto produkt per sysselsatt kan være et nyttig mål på produktivitet i offentlig sektor, er det nødvendig å bruke flere mål for å få et mer omfattende bilde av produktiviteten i sektoren. Kvalitet og effektivitet er også viktige mål for offentlig sektor, og kan gi et mer komplett bilde av produktiviteten i sektoren. Dermed kan det være et nyttig supplement til andre mål på produktivitet og effektivitet i offentlig sektor.

**Oppgave 3 - 40%** Lag figurer som viser bruttoprodukt per næring i både faste og løpende priser mellom 2012 og 2022. Diskuter hvorvidt det er noen næringer hvor variasjon i produktprisene har særlig stor innvirkning på verdien av bruttoproduksjonen.

```{r}
df_oppg3_wide <- df2 %>%
  pivot_wider(names_from = var, values_from = verdi) %>% 
  #select(-'Produktinnsats. Løpende priser (mill. kr)',-'Produksjon i basisverdi. Løpende priser (mill. kr)') %>% 
  rename(løpende = 'Bruttoprodukt i basisverdi. Løpende priser (mill. kr)') %>% 
  rename(faste = 'Bruttoprodukt i basisverdi. Faste 2020-priser (mill. kr)')

test <- df_oppg3_wide %>% 
  
  filter(year >= 2012) %>% 
  pivot_longer(cols=c(løpende, faste), names_to='pris', values_to='verdi')
  
 test %>%
   filter(næring %in% c( 'Helse- og omsorgstjenester', 'Jordbruk og skogbruk', 'Fiske, fangst og akvakultur', 'Faglig, vitenskapelig og teknisk tjenesteyting' )) %>%  
  ggplot(aes(x=as.factor(year), y=verdi, fill=pris)) + 
  geom_col(position = 'dodge', alpha = 0.8) +
  facet_wrap(~næring)+
  #scale_y_log10() +  # add log scale to y-axis
  scale_fill_manual(values=c('darkred', 'cornflowerblue')) +
  scale_x_discrete(breaks=unique(df_oppg3_wide$year)) +
  labs(x='År', y='mill kr', fill='Pris') +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  ylim(0,500000)
```

Næringer som er sterkt avhengige av råvarer eller energiprodukter, kan oppleve store svingninger i bruttoproduktet på grunn av variasjoner i produktprisene. Dette skyldes at prisene på råvarer og energi ofte kan være svært uforutsigbar, og påvirkes av faktorer som tilbud og etterspørsel, geopolitiske hendelser, valutakurser og klimatiske forhold.

Eksempler på slike næringer inkluderer olje- og gassindustrien, gruveindustrien, jordbrukssektoren og fiskeindustrien. Variasjoner i produktprisene kan ha en betydelig innvirkning på bruttoproduksjonen i disse sektorene. For eksempel kan et fall i prisen på olje og gass føre til en reduksjon i bruttoproduksjonen i olje- og gassindustrien, mens en økning i prisene på jordbruksprodukter kan føre til en økning i bruttoproduksjonen i jordbrukssektoren.

På den annen side er det også næringer som ikke nødvendigvis er så følsomme for endringer i produktprisene. For eksempel kan tjenestenæringer som helsevesen, utdanning og teknologisektoren i mindre grad påvirkes av slike variasjoner. Dette skyldes at disse sektorene er mindre avhengige av råvarer og energi, og i større grad er avhengige av andre faktorer som teknologiutvikling, innovasjon, og kvaliteten på tjenestene som tilbys.

```{r}
test %>% 
  filter(year >= 2012) %>% 
  filter(næring == 'Utvinning av råolje og naturgass, inkl. tjenester') %>% 
  ggplot(aes(x=as.factor(year), group = næring, fill = pris)) + 
  geom_col(data = filter(test, pris == "løpende"), aes(y = verdi), position = "dodge") +
  geom_col(data = filter(test, pris == "faste"), aes(y = verdi), position = "dodge") +
  facet_wrap(~pris)+
  scale_fill_manual(values=c('red', 'blue')) +
  labs(x='År', y='Mill. kr', fill='pris', title = 'Utvinning av råolje og naturgass, inkl. tjenester') +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

**Oppgave 4 - 10%**

I norsk sammenheng skiller vi ofte mellom brutto nasjonal produkt (BNP) og brutto nasjonalprodukt på fastlandet (FN-BNP). Hvilke næringer er unntatt fra FN-BNP, og hvorfor gjøres dette? Knytt gjerne besvarelsen til funnene fra oppgave 3.

Olje og gass trekkes fra fordi det er en inntektskilde som varierer veldig på grunn av markedet. Det er derfor lettere å lete etter sammenhenger i økonomien uten denne sektoren, det er også lettere å sammenlikne målingene internasjonalt. Det er først og fremst produktivitetsveksten i fastlandsøkonomien som bestemmer velstanden i Norge. En stor del av produksjonverdien kan være grunnrente.

Det er lagt vekt på makedsrettede fastlandsnæringer fordi produksjonen i offentlig sektor og boligtjenster ikke omsettes i markeder, det gjør at produksjonstallene stort sett er basert på kostnader.
